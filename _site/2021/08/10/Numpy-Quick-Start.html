<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Numpy快速入门 | Tingsven’s blog</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Numpy快速入门" />
<meta name="author" content="周子博" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="What &amp; Why" />
<meta property="og:description" content="What &amp; Why" />
<link rel="canonical" href="http://localhost:4000/2021/08/10/Numpy-Quick-Start.html" />
<meta property="og:url" content="http://localhost:4000/2021/08/10/Numpy-Quick-Start.html" />
<meta property="og:site_name" content="Tingsven’s blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-08-10T00:00:00+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Numpy快速入门" />
<script type="application/ld+json">
{"author":{"@type":"Person","name":"周子博"},"@type":"BlogPosting","headline":"Numpy快速入门","dateModified":"2021-08-10T00:00:00+08:00","url":"http://localhost:4000/2021/08/10/Numpy-Quick-Start.html","description":"What &amp; Why","datePublished":"2021-08-10T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2021/08/10/Numpy-Quick-Start.html"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

    <meta name="keywords"  content="Python">
    <link rel="stylesheet" href="//cdn.staticfile.org/normalize/6.0.0/normalize.min.css">
    <link rel="stylesheet" href="//at.alicdn.com/t/font_roc50gemkxpw4s4i.css">
    <link rel="stylesheet" href="/assets/css/github-markdown.css">
    <link rel="stylesheet" href="/assets/css/prism.css">
    <link rel="stylesheet" href="/assets/css/share.min.css">
    <link rel="stylesheet" href="/assets/css/app.min.css">
    <link rel="stylesheet" href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="/assets/css/zoom.css">
    <script src="https://cdn.staticfile.org/jquery/3.2.1/jquery.min.js"></script>
    <script src="/assets/js/transition.js"></script>
    <script src="/assets/js/zoom.js"></script>
	
	<!--
Author: Ray-Eldath
refer to:
 - http://docs.mathjax.org/en/latest/options/index.html
-->

	<script type="text/javascript" async src="https://cdn.bootcss.com/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML"></script>
	
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
		jax: ["input/TeX", "output/HTML-CSS"],
		tex2jax: {
			inlineMath: [ ["$", "$"] ],
			displayMath: [ ["$$", "$$"] ],
			skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
		},
		"HTML-CSS": { preferredFont: "TeX", availableFonts: ["STIX","TeX"] }
      });
    </script>

	
    <!--
Author: Ray-Eldath
-->
<style>
    .markdown-body .anchor{
        float: left;
        margin-top: -8px;
        margin-left: -20px;
        padding-right: 4px;
        line-height: 1;
        opacity: 0;
    }
    
    .markdown-body .anchor .anchor-icon{
        font-size: 15px
    }
</style>
<script>
    $(document).ready(function() {
        let nodes = document.querySelector(".markdown-body").querySelectorAll("h1,h2,h3")
        for(let node of nodes) {
            var anchor = document.createElement("a")
            var anchorIcon = document.createElement("i")
            anchorIcon.setAttribute("class", "fa fa-anchor fa-lg anchor-icon")
            anchorIcon.setAttribute("aria-hidden", true)
            anchor.setAttribute("class", "anchor")
            anchor.setAttribute("href", "#" + node.getAttribute("id"))
            
            anchor.onmouseover = function() {
                this.style.opacity = "0.4"
            }
            
            anchor.onmouseout = function() {
                this.style.opacity = "0"
            }
            
            anchor.appendChild(anchorIcon)
            node.appendChild(anchor)
        }
    })
</script>
    <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-146060169-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-146060169-1');
</script>
</head>


<body>
  <!--[if lt IE 10]>
<div class="alert-danger" role="alert">你的浏览器实在太太太旧了，放学别走，升级完浏览器再说！<a target="_blank" class="alert-link" href="http://browsehappy.com">立即升级</a></div>
<![endif]-->
  <input id="nm-switch" type="hidden" value="false"> <header class="g-header">
    <div class="g-logo">
      <a href="/"></a>
    </div>
    <i id="menu-toggle" class="iconfont icon-menu"></i>
    <nav class="g-nav">
        <ul>
            
            <li><a href="/">home</a></li>
            
            <li><a href="/tags.html">tags</a></li>
            
        </ul>
    </nav>
</header>


  <header
    class="g-banner post-header post-pattern-glamorous bgcolor-default "
    data-theme="default"
  >
    <div class="post-wrapper">
      <div class="post-tags">
        
          
            <a href="http://localhost:4000/tags#Python" class="post-tag">Python</a>
          
        
      </div>
      <h1>Numpy快速入门</h1>
      <div class="post-meta">
        <span class="post-meta-item"><i class="iconfont icon-author"></i>周子博</span>
        <time class="post-meta-item" datetime="21-08-10"><i class="iconfont icon-date"></i>10 Aug 2021</time>
        <i class="iconfont icon-search"></i> <span id="/2021/08/10/Numpy-Quick-Start.html" class="post-meta-item leancloud_visitors" data-flag-title="Numpy快速入门">-</span> 次阅读
      </div>
    </div>
    
    <div class="filter"></div>
      <div class="post-cover" style="background: url('/assets/img/2021-08-10/numpylogo.svg') center no-repeat; background-size: cover;"></div>
    
  </header>

  <div class="post-content visible">
    
    <h2 class="post-subtitle">阅读官方QuickStart的一些分享笔记</h2>
    

    <article class="markdown-body">
      <h2 id="what--why">What &amp; Why</h2>

<p>NumPy实质上就是一个科学计算的Python基础库，提供多维数组对象，及其各种派生对象如masked数组和矩阵，并且提供对这些对象的一系列快速操作，包括数学、逻辑、形状处理、排序、选择、I/O、离散傅里叶变换、基本线性代数、基本统计运算、随机模拟等等。</p>

<p>NumPy的核心是多维数组<code class="highlighter-rouge">n-dimensional arrays</code>，即<code class="highlighter-rouge">ndarray</code>对象，其封装了一个同数据类型的多维数组，同时提供了许多由预先编译好的代码来执行的操作，以提供更好的性能表现。</p>

<p>与Python <code class="highlighter-rouge">list</code>数据类型不同的是：</p>

<ul>
  <li><code class="highlighter-rouge">ndarray</code>创建时固定大小，改变数组大小时会新创建一个数组并删除原来的数组，而<code class="highlighter-rouge">list</code>允许动态增长。</li>
  <li><code class="highlighter-rouge">ndarray</code>数组内的元素均为同一数据类型，在内存中也是同样的大小，<code class="highlighter-rouge">list</code>则没有要求。</li>
  <li><code class="highlighter-rouge">ndarray</code>便于对大量数据进行高阶数学以及其他类型的运算操作，和<code class="highlighter-rouge">list</code>相比能提供更高的性能，使用更少的代码。</li>
  <li>现在绝大多数的科学和数学Python库内部都是在使用NumPy数组。一般来说这些库都会支持Python原生数据类型的输入，然后在处理和计算前转成<code class="highlighter-rouge">ndarray</code>，计算结果通常也会返回<code class="highlighter-rouge">ndarray</code>。</li>
</ul>

<blockquote>
  <p>NumPy的目的就是为了具有C语言的速度，同时具有Python的代码便捷性。</p>
</blockquote>

<h2 id="理解基础">理解基础</h2>

<p>对于NumPy多维数组，需要先理解几个概念：</p>

<ul>
  <li>
    <p><code class="highlighter-rouge">axis</code>：<em>轴</em>，NumPy把维度叫做轴，如果觉得不好理解可以先替换成<em>维度</em>，同时往下继续读，之后便会理解。<em>轴</em>是多维数组里最重要的概念，轴和维度在某些程度上概念相似，但是轴还具备了方向性，表示了同一个维度下数组前进的方向，或者说索引增长的方向。</p>

    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># 只有一个轴/维度，该轴内有3个元素，所以该轴长度为3，轴的方向是从1-&gt;2-&gt;1
</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
  
<span class="c1"># 有两个轴/维度，第一个轴长度为2，第二个轴长度为3。如同C里的多维数组a[2][3]
# 对[1, 0, 0]和[0, 1, 2]这两个元素来说，它们同在第一个轴，属于同一个维度
# 但是轴前进的方向是从[1, 0, 0]指向[0, 1, 2]
# 如同索引增长的方向a[0][] -&gt; [1][]
# 第二个轴的方向同理
</span><span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
<span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]]</span>
</code></pre></div>    </div>
  </li>
  <li><code class="highlighter-rouge">ndim</code>：<em>数组轴/维度的数量</em>，如<code class="highlighter-rouge">a[2][3]</code>就是有两个轴/二维。</li>
  <li><code class="highlighter-rouge">shape</code>：<em>表示数组各轴/维度长度的tuple</em>，比如<code class="highlighter-rouge">a[2][3]</code>的<code class="highlighter-rouge">shape</code>就是<code class="highlighter-rouge">(2,3)</code>。</li>
  <li><code class="highlighter-rouge">size</code>：<em>数组全部元素的数量</em>，值等于<code class="highlighter-rouge">shape</code>里各元素的乘积。</li>
  <li><code class="highlighter-rouge">dtype</code>：<em>描述数组数据类型的对象</em>，如<code class="highlighter-rouge">numpy.int32</code>，<code class="highlighter-rouge">numpy.int16</code>，<code class="highlighter-rouge">numpy.float64</code>等。</li>
  <li><code class="highlighter-rouge">itemsize</code>：<em>数组中一个元素的大小，单位字节bytes</em>，大小等于<code class="highlighter-rouge">ndarray.dtype.itemsize</code>。比如<code class="highlighter-rouge">float64</code>的<code class="highlighter-rouge">itemsize</code>为8(=64/8)</li>
  <li><code class="highlighter-rouge">data</code>：<em>存储数组实际元素的buffer</em>。</li>
</ul>

<h3 id="创建数组">创建数组</h3>

<p>通过<code class="highlighter-rouge">np.array()</code>传入一个Python序列(<code class="highlighter-rouge">list</code>或者<code class="highlighter-rouge">tuple</code>)创建一个NumPy数组。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">a</span>
<span class="n">array</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span> 
<span class="o">&gt;&gt;&gt;</span> <span class="n">a</span><span class="p">.</span><span class="n">dtype</span>
<span class="n">dtype</span><span class="p">(</span><span class="s">'int32'</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.2</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> <span class="mf">5.1</span><span class="p">])</span> 
<span class="o">&gt;&gt;&gt;</span> <span class="n">b</span><span class="p">.</span><span class="n">dtype</span>
<span class="n">dtype</span><span class="p">(</span><span class="s">'float64'</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">type</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="o">&lt;</span><span class="k">class</span> <span class="err">'</span><span class="nc">numpy</span><span class="p">.</span><span class="n">ndarray</span><span class="s">'&gt;
</span></code></pre></div></div>

<p><code class="highlighter-rouge">np.zeros()</code>/<code class="highlighter-rouge">np.ones()</code>/<code class="highlighter-rouge">np.empty()</code>这三种方法用来创建具有初始内容(placeholder)的多维数组，需要传入一个<code class="highlighter-rouge">tuple</code>来描述<code class="highlighter-rouge">shape</code>，如果不传入<code class="highlighter-rouge">dtype</code>则默认<code class="highlighter-rouge">float64</code>，所以用这类方式要考虑元素的类型<code class="highlighter-rouge">dtype</code>，避免造成内存空间上的浪费。类似的创建方式还有<code class="highlighter-rouge">np.fromfunction()</code>,<code class="highlighter-rouge">np.fromfile</code>等。</p>

<p><code class="highlighter-rouge">np.arange()</code>会用类似Python <code class="highlighter-rouge">range()</code>的方式创建一个有序的数组，<code class="highlighter-rouge">dtype</code>默认为<code class="highlighter-rouge">int</code>。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">array</span><span class="p">([[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span>
       <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span>
       <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">]])</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">np</span><span class="p">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="n">int16</span><span class="p">)</span>
<span class="n">array</span><span class="p">([[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]],</span>

       <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">int16</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">np</span><span class="p">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span> <span class="c1"># 初始内容随机，为内存中的值
</span><span class="n">array</span><span class="p">([[</span><span class="mf">3.73603959e-262</span><span class="p">,</span> <span class="mf">6.02658058e-154</span><span class="p">,</span> <span class="mf">6.55490914e-260</span><span class="p">],</span>
       <span class="p">[</span><span class="mf">5.30498948e-313</span><span class="p">,</span> <span class="mf">3.14673309e-307</span><span class="p">,</span> <span class="mf">1.00000000e+000</span><span class="p">]])</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">np</span><span class="p">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="c1"># 与Python range类似
</span><span class="n">array</span><span class="p">([</span><span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">25</span><span class="p">])</span>    

<span class="c1"># 对于浮点数步进的arange，可能因为精度问题无法获得我们想要的数组内容，
# 可以使用linspace方法来等分一个数值区间
</span><span class="o">&gt;&gt;&gt;</span> <span class="n">np</span><span class="p">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
<span class="n">array</span><span class="p">([</span><span class="mf">0.</span>  <span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.5</span> <span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="mf">1.</span>  <span class="p">,</span> <span class="mf">1.25</span><span class="p">,</span> <span class="mf">1.5</span> <span class="p">,</span> <span class="mf">1.75</span><span class="p">,</span> <span class="mf">2.</span>  <span class="p">])</span>
</code></pre></div></div>

<h3 id="打印数组">打印数组</h3>

<p>当你调用<code class="highlighter-rouge">print(ndarray)</code>打印数组时，NumPy会用类似嵌套列表的方式显示该数组内容，按照以下规则打印：</p>

<ul>
  <li>从左到右打印最后一个轴/维度</li>
  <li>从上到下打印倒数第二个轴/维度</li>
  <li>从上到下打印剩下的轴/维度，但是每个维度的切片之间会间隔n-2个空行，n表示相邻两个切片属于倒数第n个维度</li>
</ul>

<blockquote>
  <p>超过一定规模的多维数组，NumPy只会打印数组的corners，而跳过中间的部分</p>
</blockquote>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">36</span><span class="p">).</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="c1"># 四维数组
</span><span class="o">&gt;&gt;&gt;</span> <span class="k">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="p">[[[[</span> <span class="mi">0</span>  <span class="mi">1</span>  <span class="mi">2</span><span class="p">]</span>
   <span class="p">[</span> <span class="mi">3</span>  <span class="mi">4</span>  <span class="mi">5</span><span class="p">]</span>
   <span class="p">[</span> <span class="mi">6</span>  <span class="mi">7</span>  <span class="mi">8</span><span class="p">]]</span>

  <span class="p">[[</span> <span class="mi">9</span> <span class="mi">10</span> <span class="mi">11</span><span class="p">]</span>
   <span class="p">[</span><span class="mi">12</span> <span class="mi">13</span> <span class="mi">14</span><span class="p">]</span>
   <span class="p">[</span><span class="mi">15</span> <span class="mi">16</span> <span class="mi">17</span><span class="p">]]]</span>


 <span class="p">[[[</span><span class="mi">18</span> <span class="mi">19</span> <span class="mi">20</span><span class="p">]</span>
   <span class="p">[</span><span class="mi">21</span> <span class="mi">22</span> <span class="mi">23</span><span class="p">]</span>
   <span class="p">[</span><span class="mi">24</span> <span class="mi">25</span> <span class="mi">26</span><span class="p">]]</span>

  <span class="p">[[</span><span class="mi">27</span> <span class="mi">28</span> <span class="mi">29</span><span class="p">]</span>
   <span class="p">[</span><span class="mi">30</span> <span class="mi">31</span> <span class="mi">32</span><span class="p">]</span>
   <span class="p">[</span><span class="mi">33</span> <span class="mi">34</span> <span class="mi">35</span><span class="p">]]]]</span>

<span class="o">&gt;&gt;&gt;</span> <span class="k">print</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10000</span><span class="p">))</span>
<span class="p">[</span>   <span class="mi">0</span>    <span class="mi">1</span>    <span class="mi">2</span> <span class="p">...</span> <span class="mi">9997</span> <span class="mi">9998</span> <span class="mi">9999</span><span class="p">]</span>
</code></pre></div></div>

<h3 id="基本操作">基本操作</h3>

<ol>
  <li>
    <p>NumPy数组的算术运算都是逐元素的。运算结果会创建一个新的<code class="highlighter-rouge">ndarray</code>并填充结果返回。值得注意的是，在此规则下，<code class="highlighter-rouge">ndarray</code>表示的矩阵的乘法要用<code class="highlighter-rouge">@</code>或者<code class="highlighter-rouge">dot()</code>，否则用<code class="highlighter-rouge">*</code>运算符会表示逐元素相乘。</p>

    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="o">&gt;&gt;&gt;</span> <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([</span><span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">50</span><span class="p">])</span>
 <span class="o">&gt;&gt;&gt;</span> <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
 <span class="o">&gt;&gt;&gt;</span> <span class="n">b</span>
 <span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
 <span class="o">&gt;&gt;&gt;</span> <span class="n">c</span> <span class="o">=</span> <span class="n">a</span> <span class="o">-</span> <span class="n">b</span>
 <span class="o">&gt;&gt;&gt;</span> <span class="n">c</span>
 <span class="n">array</span><span class="p">([</span><span class="mi">20</span><span class="p">,</span> <span class="mi">29</span><span class="p">,</span> <span class="mi">38</span><span class="p">,</span> <span class="mi">47</span><span class="p">])</span>
 <span class="o">&gt;&gt;&gt;</span> <span class="n">b</span><span class="o">**</span><span class="mi">2</span>
 <span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">9</span><span class="p">])</span>
 <span class="o">&gt;&gt;&gt;</span> <span class="n">a</span> <span class="o">&lt;</span> <span class="mi">35</span>
 <span class="n">array</span><span class="p">([</span> <span class="bp">True</span><span class="p">,</span>  <span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">False</span><span class="p">])</span>
 <span class="o">&gt;&gt;&gt;</span> <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
 <span class="p">...</span>               <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>
 <span class="o">&gt;&gt;&gt;</span> <span class="n">B</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
 <span class="p">...</span>               <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]])</span>
 <span class="o">&gt;&gt;&gt;</span> <span class="n">A</span> <span class="o">*</span> <span class="n">B</span>     <span class="c1"># 逐元素相乘
</span> <span class="n">array</span><span class="p">([[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
       <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">]])</span>
 <span class="o">&gt;&gt;&gt;</span> <span class="n">A</span> <span class="o">@</span> <span class="n">B</span>     <span class="c1"># 矩阵乘法
</span> <span class="n">array</span><span class="p">([[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
       <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]])</span>
 <span class="o">&gt;&gt;&gt;</span> <span class="n">A</span><span class="p">.</span><span class="n">dot</span><span class="p">(</span><span class="n">B</span><span class="p">)</span>  <span class="c1"># 矩阵乘法
</span> <span class="n">array</span><span class="p">([[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
       <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]])</span>
</code></pre></div>    </div>
  </li>
  <li>一些运算符如<code class="highlighter-rouge">+=</code>,<code class="highlighter-rouge">*=</code>不会创建一个新的数组返回，而是在现有数组上直接操作(In-place)。这可以节省开辟和释放内存的开销。</li>
  <li>
    <p>NumPy随机多维数组的写法：</p>

    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="n">rg</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">default_rng</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># 随机数生成器 random number generator
</span> <span class="n">rg</span><span class="p">.</span><span class="n">random</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span> <span class="c1"># 创建对应维数和长度的随机数组，值范围(0,1)，自行缩放映射
</span></code></pre></div>    </div>
  </li>
  <li>
    <p>NumPy数组提供许多内置的一元运算操作，比如对一个<code class="highlighter-rouge">ndarray a</code>,有所有元素求和<code class="highlighter-rouge">a.sum()</code>,取最小<code class="highlighter-rouge">a.min()</code>,取最大<code class="highlighter-rouge">a.max()</code>。如果不传入任何参数，这些操作会忽视掉NumPy数组的轴/维度（或者说shape），单纯看作一系列数字操作。<strong><em>如果传入<code class="highlighter-rouge">axis</code>参数，这些操作就会只沿着所声明的轴/维度的方向进行</em></strong>。如果对轴的方向有问题请回顾<a href="##理解基础">这里</a>。</p>

    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="o">&gt;&gt;&gt;</span> <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">12</span><span class="p">).</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
 <span class="o">&gt;&gt;&gt;</span> <span class="n">b</span>
 <span class="n">array</span><span class="p">([[</span> <span class="mi">0</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span>  <span class="mi">3</span><span class="p">],</span>
       <span class="p">[</span> <span class="mi">4</span><span class="p">,</span>  <span class="mi">5</span><span class="p">,</span>  <span class="mi">6</span><span class="p">,</span>  <span class="mi">7</span><span class="p">],</span>
       <span class="p">[</span> <span class="mi">8</span><span class="p">,</span>  <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">]])</span>
 <span class="o">&gt;&gt;&gt;</span>
 <span class="o">&gt;&gt;&gt;</span> <span class="n">b</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>     <span class="c1"># 沿着第一个轴/维度的方向（列方向）求和
</span> <span class="n">array</span><span class="p">([</span><span class="mi">12</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">21</span><span class="p">])</span>
 <span class="o">&gt;&gt;&gt;</span>
 <span class="o">&gt;&gt;&gt;</span> <span class="n">b</span><span class="p">.</span><span class="nb">min</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>     <span class="c1"># 沿着第二个轴/维度的方向(行方向)求最小值
</span> <span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">])</span>
 <span class="o">&gt;&gt;&gt;</span>
 <span class="o">&gt;&gt;&gt;</span> <span class="n">b</span><span class="p">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># 沿着第二个轴/维度的方向(行方向)求累加值
</span> <span class="n">array</span><span class="p">([[</span> <span class="mi">0</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span>  <span class="mi">6</span><span class="p">],</span>
       <span class="p">[</span> <span class="mi">4</span><span class="p">,</span>  <span class="mi">9</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">22</span><span class="p">],</span>
       <span class="p">[</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">27</span><span class="p">,</span> <span class="mi">38</span><span class="p">]])</span>
</code></pre></div>    </div>
  </li>
</ol>

<h3 id="通用函数">通用函数</h3>

<p>NumPy还提供了许多数学函数如<code class="highlighter-rouge">np.sin()</code>,<code class="highlighter-rouge">np.cos()</code>,<code class="highlighter-rouge">np.exp()</code>,<code class="highlighter-rouge">np.sqrt()</code>等等，这些被称为<em>universal functions</em>，<code class="highlighter-rouge">ufunc</code>，这些运算也是逐元素进行的，并且会创建一个新的数组作为结果返回。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">B</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">B</span>
<span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">np</span><span class="p">.</span><span class="n">exp</span><span class="p">(</span><span class="n">B</span><span class="p">)</span>
<span class="n">array</span><span class="p">([</span><span class="mf">1.</span>        <span class="p">,</span> <span class="mf">2.71828183</span><span class="p">,</span> <span class="mf">7.3890561</span> <span class="p">])</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">np</span><span class="p">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">B</span><span class="p">)</span>
<span class="n">array</span><span class="p">([</span><span class="mf">0.</span>        <span class="p">,</span> <span class="mf">1.</span>        <span class="p">,</span> <span class="mf">1.41421356</span><span class="p">])</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([</span><span class="mf">2.</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">4.</span><span class="p">])</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">np</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">)</span>
<span class="n">array</span><span class="p">([</span><span class="mf">2.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">6.</span><span class="p">])</span>
</code></pre></div></div>

<h3 id="索引切片迭代">索引、切片、迭代</h3>

<p>一维的数组索引、切片与Python序列一致。比较需要理解的是多维数组的索引切片。每个维度之间的切片索引用逗号间隔。如果提供的索引数比轴/维度的数量少，则未提供索引的轴会被人为切取全部内容。且NumPy支持用<code class="highlighter-rouge">...</code>来填充未给出切片索引的轴。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">b</span> <span class="c1"># 一个(5, 4) shape的二维NumPy数组
</span><span class="n">array</span><span class="p">([[</span> <span class="mi">0</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span>  <span class="mi">3</span><span class="p">],</span>
       <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">],</span>
       <span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">23</span><span class="p">],</span>
       <span class="p">[</span><span class="mi">30</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">33</span><span class="p">],</span>
       <span class="p">[</span><span class="mi">40</span><span class="p">,</span> <span class="mi">41</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="mi">43</span><span class="p">]])</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">b</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="mi">23</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># 每一行，第二列
</span><span class="n">array</span><span class="p">([</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">41</span><span class="p">])</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">b</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>    <span class="c1"># 同上
</span><span class="n">array</span><span class="p">([</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">41</span><span class="p">])</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:]</span>  <span class="c1"># 第二和第三行，所有列
</span><span class="n">array</span><span class="p">([[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">],</span>
       <span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">23</span><span class="p">]])</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">b</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>   <span class="c1"># 等同于 b[-1, :]，取最后一行，所有列
</span><span class="n">array</span><span class="p">([</span><span class="mi">40</span><span class="p">,</span> <span class="mi">41</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="mi">43</span><span class="p">])</span>


<span class="o">&gt;&gt;&gt;</span> <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([[[</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">2</span><span class="p">],</span>  <span class="c1"># 一个(2, 2, 3)shape的三维数组
</span><span class="p">...</span>                <span class="p">[</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">]],</span>
<span class="p">...</span>               <span class="p">[[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">102</span><span class="p">],</span>
<span class="p">...</span>                <span class="p">[</span><span class="mi">110</span><span class="p">,</span> <span class="mi">112</span><span class="p">,</span> <span class="mi">113</span><span class="p">]]])</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">...]</span>  <span class="c1"># 等同于 c[1, :, :] or c[1]
</span><span class="n">array</span><span class="p">([[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">102</span><span class="p">],</span>
       <span class="p">[</span><span class="mi">110</span><span class="p">,</span> <span class="mi">112</span><span class="p">,</span> <span class="mi">113</span><span class="p">]])</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">c</span><span class="p">[...,</span> <span class="mi">2</span><span class="p">]</span>  <span class="c1"># 等同于 c[:, :, 2]
</span><span class="n">array</span><span class="p">([[</span>  <span class="mi">2</span><span class="p">,</span>  <span class="mi">13</span><span class="p">],</span>
       <span class="p">[</span><span class="mi">102</span><span class="p">,</span> <span class="mi">113</span><span class="p">]])</span>
</code></pre></div></div>

<blockquote>
  <p>关于多维数组切片的结果是否是多维，是多少维度的数组，取决于各维度的切片索引。如果在某一个维度只取一个固定索引的值，则该维度便会消失。如上<code class="highlighter-rouge">b[2, 3]</code>，两个固定索引，所以两个维度都消失了，只得到一个元素。<code class="highlighter-rouge">b[1:3, :]</code>则得到一个二维数组。</p>
</blockquote>

<p>关于NumPy数组的迭代，可以直接使用<code class="highlighter-rouge">for</code>循环按照第一个轴进行迭代</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">b</span><span class="p">:</span>
<span class="p">...</span>     <span class="k">print</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
<span class="p">...</span>
<span class="p">[</span><span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">]</span>
<span class="p">[</span><span class="mi">10</span> <span class="mi">11</span> <span class="mi">12</span> <span class="mi">13</span><span class="p">]</span>
<span class="p">...</span>
</code></pre></div></div>

<p>也可以使用迭代器<code class="highlighter-rouge">ndarray.flat</code>进行逐元素的迭代</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">b</span><span class="p">.</span><span class="n">flat</span><span class="p">:</span>
<span class="p">...</span>     <span class="k">print</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
<span class="p">...</span>
<span class="mi">0</span>
<span class="mi">1</span>
<span class="mi">2</span>
<span class="mi">3</span>
<span class="p">...</span>

</code></pre></div></div>

<h2 id="shape操作">Shape操作</h2>

<h3 id="改变ndarray-shape">改变ndarray shape</h3>

<p><code class="highlighter-rouge">ndarray.ravel()</code>展开成一维数组,<code class="highlighter-rouge">ndarray.reshape()</code>维度变换,<code class="highlighter-rouge">ndarray.T</code>返回转置数组。注意这些操作都不会改变原数组，而是返回一个新的数组。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">a</span> <span class="c1"># shape (3, 4)
</span><span class="n">array</span><span class="p">([[</span><span class="mf">3.</span><span class="p">,</span> <span class="mf">7.</span><span class="p">,</span> <span class="mf">3.</span><span class="p">,</span> <span class="mf">4.</span><span class="p">],</span>
       <span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">4.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">],</span>
       <span class="p">[</span><span class="mf">7.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">4.</span><span class="p">,</span> <span class="mf">9.</span><span class="p">]])</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">a</span><span class="p">.</span><span class="n">ravel</span><span class="p">()</span>  <span class="c1"># 展开成一维，展开方式是"C-style"，即沿着最后一个轴的方向展开，在二维就是逐行展开
</span><span class="n">array</span><span class="p">([</span><span class="mf">3.</span><span class="p">,</span> <span class="mf">7.</span><span class="p">,</span> <span class="mf">3.</span><span class="p">,</span> <span class="mf">4.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">4.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">7.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">4.</span><span class="p">,</span> <span class="mf">9.</span><span class="p">])</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">a</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># 返回修改shape后的数组
</span><span class="n">array</span><span class="p">([[</span><span class="mf">3.</span><span class="p">,</span> <span class="mf">7.</span><span class="p">],</span>
       <span class="p">[</span><span class="mf">3.</span><span class="p">,</span> <span class="mf">4.</span><span class="p">],</span>
       <span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">4.</span><span class="p">],</span>
       <span class="p">[</span><span class="mf">2.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">],</span>
       <span class="p">[</span><span class="mf">7.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">],</span>
       <span class="p">[</span><span class="mf">4.</span><span class="p">,</span> <span class="mf">9.</span><span class="p">]])</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">a</span><span class="p">.</span><span class="n">T</span>  <span class="c1"># 返回转置后的数组
</span><span class="n">array</span><span class="p">([[</span><span class="mf">3.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">7.</span><span class="p">],</span>
       <span class="p">[</span><span class="mf">7.</span><span class="p">,</span> <span class="mf">4.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">],</span>
       <span class="p">[</span><span class="mf">3.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">4.</span><span class="p">],</span>
       <span class="p">[</span><span class="mf">4.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">9.</span><span class="p">]])</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">a</span><span class="p">.</span><span class="n">T</span><span class="p">.</span><span class="n">shape</span>
<span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">a</span><span class="p">.</span><span class="n">shape</span>
<span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
</code></pre></div></div>

<blockquote>
  <p>NumPy normally creates arrays stored in this order, so ravel will usually not need to copy its argument, but if the array was made by taking slices of another array or created with unusual options, it may need to be copied.<br />
这一段没太读懂，是指正常创建的数组在ravel()展开时不需要拷贝？但是ravel返回的不是一个新的数组吗，为什么不需要拷贝呢？<br />
答：ravel reshape resize这些操作返回的都是一个新的ndarray对象，或者说视图而已，都不会涉及内存的拷贝。可以参考<a href="###视图/浅拷贝">这里</a>，但是当从一个已经是切片的数组展开的话，或者是通过一些不寻常（复杂）的方法创建的话，NumPy会进行内存拷贝（数据深拷贝），这个应该是NumPy的优化，应该是为了避免对视图操作的叠加导致效率还不如深拷贝。</p>
</blockquote>

<p>与<code class="highlighter-rouge">reshape()</code>返回新数组不改变原数组相比，<code class="highlighter-rouge">resize()</code>用法一致，但是改变了原数组。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">a</span><span class="p">.</span><span class="n">resize</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span> <span class="c1"># 改变了数组本身
</span><span class="o">&gt;&gt;&gt;</span> <span class="n">a</span>
<span class="n">array</span><span class="p">([[</span><span class="mf">3.</span><span class="p">,</span> <span class="mf">7.</span><span class="p">,</span> <span class="mf">3.</span><span class="p">,</span> <span class="mf">4.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">4.</span><span class="p">],</span>
       <span class="p">[</span><span class="mf">2.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">7.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">4.</span><span class="p">,</span> <span class="mf">9.</span><span class="p">]])</span>
</code></pre></div></div>

<p>如果在reshape的操作中某个轴/维度给了-1的长度，那么其长度是根据原数组的shape自动计算的。或者说，<em>全自动Reshape</em>。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">a</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">array</span><span class="p">([[</span><span class="mf">3.</span><span class="p">,</span> <span class="mf">7.</span><span class="p">,</span> <span class="mf">3.</span><span class="p">,</span> <span class="mf">4.</span><span class="p">],</span>
       <span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">4.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">],</span>
       <span class="p">[</span><span class="mf">7.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">4.</span><span class="p">,</span> <span class="mf">9.</span><span class="p">]])</span>
</code></pre></div></div>

<h2 id="数组的拷贝与视图">数组的拷贝与视图</h2>

<h3 id="无拷贝">无拷贝</h3>

<p>简单的赋值不会引起任何拷贝</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([[</span> <span class="mi">0</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span>  <span class="mi">3</span><span class="p">],</span>
<span class="p">...</span>               <span class="p">[</span> <span class="mi">4</span><span class="p">,</span>  <span class="mi">5</span><span class="p">,</span>  <span class="mi">6</span><span class="p">,</span>  <span class="mi">7</span><span class="p">],</span>
<span class="p">...</span>               <span class="p">[</span> <span class="mi">8</span><span class="p">,</span>  <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">]])</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">b</span> <span class="o">=</span> <span class="n">a</span>            <span class="c1"># 不会创建新的对象
</span><span class="o">&gt;&gt;&gt;</span> <span class="n">b</span> <span class="ow">is</span> <span class="n">a</span>           <span class="c1"># a和b是同一个ndarray对象的别名
</span><span class="bp">True</span>
</code></pre></div></div>

<p>对可变对象而言，函数调用传入的是引用，所以也不会有任何拷贝。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="p">...</span>     <span class="k">print</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="p">...</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">id</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>  <span class="c1"># id is a unique identifier of an object
</span><span class="mi">148293216</span>  
<span class="o">&gt;&gt;&gt;</span> <span class="n">f</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="mi">148293216</span>  <span class="c1"># 与id(a)一致
</span></code></pre></div></div>

<h3 id="视图浅拷贝">视图/浅拷贝</h3>

<p>不同的<code class="highlighter-rouge">ndarray</code>对象可以共享同一块数据，通过<code class="highlighter-rouge">view</code>方法可以创建一个新的<code class="highlighter-rouge">ndarray</code>对象，或者称为<em>视图</em>，其与原数组共享/引用同一块数据，所以是浅拷贝。</p>

<blockquote>
  <p>可以这样理解，所有的ndarray对象都只是对内存中连续数组的一个视图，以及操作方法的集合。虽然会标记数据属于哪个视图（第一次创建的时候），但是所有的视图都能对这一片内存的数据进行改动。视图，或者说<code class="highlighter-rouge">ndarray</code>对象自己的<code class="highlighter-rouge">reshape</code>，<code class="highlighter-rouge">resize</code>变换等操作，凡是不涉及到数据本身的改动的，都不会对其他视图造成影响。根据问题的需求，决定了内存中一块连续数据的理解方式，从而决定了需要怎样的视图。NumPy封装的就是根据不同的视图进行对应的操作。</p>
</blockquote>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">c</span> <span class="o">=</span> <span class="n">a</span><span class="p">.</span><span class="n">view</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">c</span> <span class="ow">is</span> <span class="n">a</span>
<span class="bp">False</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">c</span><span class="p">.</span><span class="n">base</span> <span class="ow">is</span> <span class="n">a</span>            <span class="c1"># c是观察a数据的视图
</span><span class="bp">True</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">c</span><span class="p">.</span><span class="n">flags</span><span class="p">.</span><span class="n">owndata</span>
<span class="bp">False</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">c</span> <span class="o">=</span> <span class="n">c</span><span class="p">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>  <span class="c1"># a数组的shape不会改变
</span><span class="o">&gt;&gt;&gt;</span> <span class="n">a</span><span class="p">.</span><span class="n">shape</span>
<span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1234</span>         <span class="c1"># a数组的数据变了
</span><span class="o">&gt;&gt;&gt;</span> <span class="n">a</span>
<span class="n">array</span><span class="p">([[</span>   <span class="mi">0</span><span class="p">,</span>    <span class="mi">1</span><span class="p">,</span>    <span class="mi">2</span><span class="p">,</span>    <span class="mi">3</span><span class="p">],</span>
       <span class="p">[</span><span class="mi">1234</span><span class="p">,</span>    <span class="mi">5</span><span class="p">,</span>    <span class="mi">6</span><span class="p">,</span>    <span class="mi">7</span><span class="p">],</span>
       <span class="p">[</span>   <span class="mi">8</span><span class="p">,</span>    <span class="mi">9</span><span class="p">,</span>   <span class="mi">10</span><span class="p">,</span>   <span class="mi">11</span><span class="p">]])</span>
</code></pre></div></div>

<p>切片会返回一个新的视图，所以会创建一个新的<code class="highlighter-rouge">ndarray</code>对象，但是不会发生内存拷贝。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">s</span> <span class="o">=</span> <span class="n">a</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">s</span><span class="p">[:]</span> <span class="o">=</span> <span class="mi">10</span>  <span class="c1"># s[:]是s的视图. 注意s=10 和s[:]=10的区别，应该是这样的写法才能进行广播？
</span><span class="o">&gt;&gt;&gt;</span> <span class="n">a</span>
<span class="n">array</span><span class="p">([[</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">10</span><span class="p">,</span>   <span class="mi">10</span><span class="p">,</span>    <span class="mi">3</span><span class="p">],</span>
       <span class="p">[</span><span class="mi">1234</span><span class="p">,</span>   <span class="mi">10</span><span class="p">,</span>   <span class="mi">10</span><span class="p">,</span>    <span class="mi">7</span><span class="p">],</span>
       <span class="p">[</span>   <span class="mi">8</span><span class="p">,</span>   <span class="mi">10</span><span class="p">,</span>   <span class="mi">10</span><span class="p">,</span>   <span class="mi">11</span><span class="p">]])</span>
</code></pre></div></div>

<h3 id="深拷贝">深拷贝</h3>

<p><code class="highlighter-rouge">ndarray.copy()</code>方法会拷贝一个NumPy数组及其数据。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">d</span> <span class="o">=</span> <span class="n">a</span><span class="p">.</span><span class="n">copy</span><span class="p">()</span>  <span class="c1"># 创建一个新的ndarray对象和新的数据
</span><span class="o">&gt;&gt;&gt;</span> <span class="n">d</span> <span class="ow">is</span> <span class="n">a</span>
<span class="bp">False</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">d</span><span class="p">.</span><span class="n">base</span> <span class="ow">is</span> <span class="n">a</span>  <span class="c1"># d 与 a 并不共享任何数据
</span><span class="bp">False</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">9999</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">a</span>
<span class="n">array</span><span class="p">([[</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">10</span><span class="p">,</span>   <span class="mi">10</span><span class="p">,</span>    <span class="mi">3</span><span class="p">],</span>
       <span class="p">[</span><span class="mi">1234</span><span class="p">,</span>   <span class="mi">10</span><span class="p">,</span>   <span class="mi">10</span><span class="p">,</span>    <span class="mi">7</span><span class="p">],</span>
       <span class="p">[</span>   <span class="mi">8</span><span class="p">,</span>   <span class="mi">10</span><span class="p">,</span>   <span class="mi">10</span><span class="p">,</span>   <span class="mi">11</span><span class="p">]])</span>
</code></pre></div></div>

<p>如果要从一大片数据中筛选出一片有用的话，往往会在切片后使用<code class="highlighter-rouge">copy</code>深拷贝，然后删除原先的<code class="highlighter-rouge">ndarray</code>对象和其引用的数据，释放内存。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="mf">1e8</span><span class="p">))</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="p">[:</span><span class="mi">100</span><span class="p">].</span><span class="n">copy</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">del</span> <span class="n">a</span>  <span class="c1"># the memory of ``a`` can be released.
</span></code></pre></div></div>

<p>如果使用切片的话，即时调用<code class="highlighter-rouge">del a</code>，因为<code class="highlighter-rouge">b</code>中仍有引用(<code class="highlighter-rouge">b.base</code>)，GC并不会回收<code class="highlighter-rouge">a</code>对象。</p>

<h3 id="函数和方法概览进阶索引使用技巧官方小贴士">函数和方法概览/进阶索引使用技巧/官方小贴士</h3>

<p>因为本文只是快速入门，进阶的技巧就不详细赘述了，请参考官方的文档学习一下，大概需要20分钟。</p>

<ul>
  <li><a href="https://numpy.org/doc/stable/user/quickstart.html#functions-and-methods-overview">方法概览</a></li>
  <li><a href="https://numpy.org/doc/stable/user/quickstart.html#advanced-indexing-and-index-tricks">进阶索引使用技巧</a></li>
  <li><a href="https://numpy.org/doc/stable/user/quickstart.html#tricks-and-tips">小贴士</a></li>
</ul>

<h2 id="additional">Additional</h2>

<p>在重构我们的光照贴图后处理部分时，我遇到了一些问题，应该可以加深你对NumPy的理解。下面是几段简化后的代码，你可以在我们的工程中找到其原型：</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dlm</span> <span class="o">=</span> <span class="n">surfaceCache</span><span class="p">.</span><span class="n">directLightMap</span><span class="p">()</span>
<span class="n">idlm</span> <span class="o">=</span> <span class="n">surfaceCache</span><span class="p">.</span><span class="n">indirectLightMap</span><span class="p">()</span>
<span class="n">ret</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="c1"># 对dlm进行后处理，结果写回ret
</span><span class="p">...</span>
<span class="n">dlm</span> <span class="o">=</span> <span class="n">ret</span>
<span class="c1"># 对idlm进行后处理，结果写回ret
</span><span class="p">...</span>
<span class="n">idlm</span> <span class="o">=</span> <span class="n">ret</span>
<span class="n">lightmap</span> <span class="o">=</span> <span class="n">dlm</span> <span class="o">+</span> <span class="n">idlm</span>
</code></pre></div></div>

<p>值得注意的是，这样的写法会导致第二次后处理结果写回<code class="highlighter-rouge">ret</code>时，<code class="highlighter-rouge">dlm</code>指向的内容也被覆盖。如果你读完了这篇入门，你应该能知道为什么。所以正确的写法应该是在第二次后处理前加上：</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># 对idlm进行后处理，结果写回ret
</span><span class="n">ret</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="p">...</span>
<span class="n">idlm</span> <span class="o">=</span> <span class="n">ret</span>
</code></pre></div></div>

<p>再看这一段代码</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">normalMapAChannel</span> <span class="o">=</span> <span class="n">normalMap</span><span class="p">[:,:,</span><span class="mi">3</span><span class="p">]</span>
<span class="n">isMasked</span> <span class="o">=</span> <span class="n">idlm</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span>
<span class="n">normalMapAChannel</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">where</span><span class="p">(</span><span class="n">isMasked</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">normalMapAChannel</span><span class="p">)</span>
</code></pre></div></div>

<p>这里用到了<code class="highlighter-rouge">np.where</code>来根据<code class="highlighter-rouge">isMasked</code>布尔型数组来有条件地改变<code class="highlighter-rouge">normalMapAChannel</code>数组。请问<code class="highlighter-rouge">normalMapAChannel</code>作为<code class="highlighter-rouge">normalMap</code>的切片/视图，指向的是同一片数据，这样可以根据<code class="highlighter-rouge">isMasked</code>中的条件修改到<code class="highlighter-rouge">normalMap</code>中的值吗？</p>

<blockquote>
  <p>答案是：不能。原因是<code class="highlighter-rouge">np.where</code>返回了一个新的ndarray数组，并且赋值给了<code class="highlighter-rouge">normalMapAChannel</code>变量，并未通过该视图去改变<code class="highlighter-rouge">normalMap</code>中的数据。如果需要这样做，则需改写最后一句为：</p>
</blockquote>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">normalMap</span><span class="p">[:,:,</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">where</span><span class="p">(</span><span class="n">isMasked</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">normalMapAChannel</span><span class="p">)</span>
<span class="c1"># 或者直接用布尔型数组作为索引，实现In-Place的赋值修改
</span><span class="n">normalMapAChannel</span><span class="p">[</span><span class="n">isMasked</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</code></pre></div></div>

<h2 id="参考">参考</h2>

<ul>
  <li><a href="https://numpy.org/doc/stable/index.html">NumPy Manual - NumPy官网</a></li>
</ul>

    </article>

    
    <div class="social-share-wrapper">
      <div class="social-share"></div>
    </div>
    
  </div>

  <section class="author-detail">
    <section class="post-footer-item author-card">
      <div class="avatar">
        <img src="https://i.loli.net/2020/03/30/rT8oDqO7iU5J6yu.jpg" alt="">
      </div>
      <div class="author-name" rel="author">周子博</div>
      <div class="bio">
        <p>爱Vera，爱生活，爱游戏</p>
      </div>
      
      <ul class="sns-links">
        
        <li>
          <a href="/contact.html" target="_blank">
                    <i class="iconfont icon-email"></i>
                </a>
        </li>
        
        <li>
          <a href="//weibo.com/swazz" target="_blank">
                    <i class="iconfont icon-weibo"></i>
                </a>
        </li>
        
        <li>
          <a href="//github.com/7ippo" target="_blank">
                    <i class="iconfont icon-github"></i>
                </a>
        </li>
        
      </ul>
      
    </section>
    <section class="post-footer-item read-next">
      
      <div class="read-next-item">
        <a href="/2021/09/05/Cuda-Cpp-Programming-Guide.html" class="read-next-link"></a>
        <section>
          <span>CUDA入门：CUDA C++ Programming Guide</span>
          <p>Why CUDA</p>
        </section>
        
        <div class="filter"></div>
        <img src="https://s2.loli.net/2021/12/07/RbH5cQsjJVY6MdC.jpg" alt="">
        
     </div>
      

      
      <div class="read-next-item">
        <a href="/2020/07/04/Intro-To-Modern-CG.html" class="read-next-link"></a>
          <section>
            <span>GAMES101毕业 - 现代计算机图形学入门</span>
            <p>现代计算机图形学入门 - 2020春季 - 闫令琪UCSB</p>
          </section>
          
          <div class="filter"></div>
          <img src="https://i.loli.net/2021/03/31/7EYRMm4yJ2o3jsh.png" alt="">
          
      </div>
      
    </section>
    
    <section class="post-footer-item comment">
        <div id="disqus_thread"></div>
    </section>
    
  </section>

  <footer class="g-footer">
  <section>Tingsven's blog ©
  
  
    2017
    -
  
  2021
  </section>
  <section>Powered by <a href="//jekyllrb.com">Jekyll</a> | <a href="https://github.com/kaeyleo/jekyll-theme-H2O">Theme H2O</a></section>
</footer>

<!-- 同时兼容http与https -->
<script src="//cdn1.lncld.net/static/js/2.5.0/av-min.js"></script>
<script>
    AV.initialize("EYgyitdcYOMWLdS6JfHNHD43-gzGzoHsz", "3hmJaI6a8V7rhyspVOMsr2oR");
    // 自己创建的Class的名字
    var name='Counter';
    function createRecord(Counter){
      // 设置 ACL
      var acl = new AV.ACL();
      acl.setPublicReadAccess(true);
      acl.setPublicWriteAccess(true);
      // 获得span的所有元素
      var elements=document.getElementsByClassName('leancloud_visitors');
      // 一次创建多条记录
      var allcounter=[];
      for (var i = 0; i < elements.length ; i++) {
        // 若某span的内容不包括 '-' ，则不必创建记录
        if(elements[i].textContent.indexOf('-') == -1){
          continue;
        }
        var title = elements[i].getAttribute('data-flag-title');
        var url = elements[i].id;
        var newcounter = new Counter();
        newcounter.setACL(acl);
        newcounter.set("title", title);
        newcounter.set("url", url);
        newcounter.set("time", 1);
        allcounter.push(newcounter);
        // 顺便更新显示span为默认值1
        elements[i].textContent=1;
      }
      AV.Object.saveAll(allcounter).then(function (todo) {
        // 成功保存记录之后
        console.log('New Visit Record Success');
      }, function (error) {
        // 异常错误 
        console.error('New Visit Record Fail: ' + error.message);
      });
    }
    function showCount(Counter){
      var $visitors = $(".leancloud_visitors");
      if($visitors.length == 0) return;
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);
      query.equalTo('url', url);
      query.find().then(function (results) {
        // 当获取到的记录为0时置默认值
        if(results.length==0){
          createRecord(Counter);
          return;
        }
        // 将获取到的数据设置为text
        var item = results[0];
        var url = item.get('url');
        var time = item.get('time');
        var element = document.getElementById(url);
        element.textContent = time + 1;
        // 访问量+1
        item.increment('time');
        item.save().then(function (testObject) {
        });
      }, function (error) {
        console.log('save error:'+error.message);
      });
    }
    $(function() {
      var Counter = AV.Object.extend(name);
      showCount(Counter);
    });
</script>


  <script src="/assets/js/social-share.min.js"></script>
  <script>
    socialShare('.social-share', {
      sites: [
        
          'wechat'
          ,
          
        
          'weibo'
          ,
          
        
          'douban'
          ,
          
        
          'twitter'
          
        
      ],
      wechatQrcodeTitle: "分享到微信朋友圈",
      wechatQrcodeHelper: '<p>扫码后点击右上角</p><p>将本文分享至朋友圈</p>'
    });
  </script>

  
  <script>
    /**
     *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
     *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
    /*
    var disqus_config = function () {
    this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
    this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    */
    (function() { // DON'T EDIT BELOW THIS LINE
      var d = document, s = d.createElement('script');
      s.src = 'https://tingsven.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
  

  <script src="/assets/js/prism.js"></script>
  <script src="/assets/js/index.min.js"></script>
</body>

</html>
